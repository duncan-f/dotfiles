var Forums={};Forums.Constants={ExpandCollapseImage:'<img src="'+ForumsRes.url_transGif+'" class="expcol"/>',ExpandCollapseLink:'<a class="expcol" href="javascript:void(0);"/>',ExpandCollapseImageRef:"img.expcol",ExpandCollapseLinkRef:"a.expcol",ThreadPageDwellTimeInSecs:30};Forums.Rte={IsOpen:false,IsReady:false,canShow:function(a){if(Forums.Rte.IsOpen===false)return true;a===true&&alert(ForumsRes.rte_alreadyOpen);return false},show:function(){if(Forums.Rte.IsOpen===true)return false;setTimeout(function(){Forums.Rte.IsReady=true},ForumsRes.rte_readyDelay);Forums.Rte.IsOpen=true;return true},hide:function(){Forums.Rte.IsOpen=false;Forums.Rte.IsReady=false},isBodyLengthValid:function(b){var a=0;if(b!==null&&Forums.Rte.trimString(b)!=="")a=b.length;if(a<4||a>6e4){alert(ForumsRes.rte_msgBodyLength);return false}else return true},trimString:function(a){var b=a.replace(/(\&nbsp\;)+/g," ");return b.replace(/^\s+|\s+$/g,"")},isUnTrustedUserPostValid:function(a){var b=Forums.Rte.getImageCount(a),c=Forums.Rte.getLinkCount(a);return b==0&&c==0},getImageCount:function(b){var c=new RegExp("<img+.*?((/>)|(</img>))","ig"),a=b===null||Forums.Rte.trimString(b)===""?0:b.match(c);if(a==null)a=0;return a},getLinkCount:function(b){var c=new RegExp("<a+.*?((/>)|)","ig"),a=b===null||Forums.Rte.trimString(b)===""?0:b.match(c);if(a==null)a=0;return a},isBodyImageCountValid:function(f){var c=0,e=new RegExp("Forums/getfile/?[0-9]*","ig"),a=Forums.Rte.getImageCount(f);if(a!==null&&a.length>0)for(var b=0;b<a.length;b++){var d=a[b].match(e);if(d!==null&&d.length>0)c++}return c>ForumsRes.rte_MaxAttachments?false:true},UnPrettifyCodeBlocks:function(a){$("pre.prettyprint",a).each(function(){$(this).removeClass("prettyprinted");$("span",$(this)).each(function(){$(this).replaceWith(function(){return $(this).contents()});$(this).html($("<div/>").text($(this).html()).html())})})}};Forums.Filters={decorateFilters:function(){var a=$(this);$("h6",this).prepend(Forums.Constants.ExpandCollapseLink);$("h6",this).click(function(){$(a).children("div.content").children("div.advanced").slideToggle("fast");$(a).toggleClass("expanded")});$("h6",this).mouseover(function(){$(a).addClass("hover")});$("h6",this).mouseout(function(){$(a).removeClass("hover")});$("div.advanced li a",this).hasClass("selected")&&$("h6",this).click()}};Forums.Message={autoSubscribeValue:function(d){var a=false;try{a=pageData.autoSubscribe;if(!a){var b=$(d).parents("li.thread");if(b!=null&&b.length>0){if($("h3 > img",b).hasClass("alert"))a=true}else{var c=$("ul.thread.menu > li > a[name='unsubscribe']");if(c!=null&&c.length>0)a=true}}}catch(e){}return a?"checked='checked'":""},edit:function(){var a=$(this).parents("li.message");$(this).click(function(){if(!Forums.Rte.canShow(true))return false;var c=$(a).attr("id")+"body",d="<textarea class='rte' id='"+c+"'></textarea>",b=$("div.body",a);Forums.Rte.UnPrettifyCodeBlocks(b);var e=$("#"+$(a).attr("id")+"_attachments").attr("value");$("div.quote",b).wrap("<blockquote/>");var g=$(b).html()+"<br/>";$.ajax({type:"POST",async:false,url:ForumsRes.get_editorUrl,data:{Id:$(a).attr("id"),body:g},success:function(a){d=a}});$(b).hide();$("div.helpful, ul.history, div.abusive, div.menu, div.votingouterbox, div.voting,span.votinglabel",a).hide();var f="<div class='editor'><form>"+d+"<input type='hidden' name='attachmentIds' value='"+e+"'/></form><div class='commands'><button name='submit'>"+ForumsRes.rte_submitText+"</button><button name='cancel'>"+ForumsRes.rte_cancelText+"</button>&nbsp;<label>"+ForumsRes.rte_reasonLabel+"</label><input type='text' name='reason'/></div><div class='ajaxError submitEditError'></div></div>";$(b).after(f);Forums.Rte.show();$("button[name='submit']",a).click(Forums.Message.submitEdit(a,$(this).attr("url")));$("button[name='cancel']",a).click(function(){Forums.Rte.hide();$("#"+c).data("tEditor")!==undefined&&$("#"+c).data("tEditor").window.focus();$("div.editor",a).remove();$(b).show();$("div.helpful, ul.history, div.abusive, div.menu,div.votingouterbox, div.voting,span.votinglabel",a).show();prettyPrint()});$("button[name='submit']",a).get(0).scrollIntoView(false);return false})},reply:function(){var a=$(this).parents("li.message");$(this).click(function(){if(!Forums.Rte.canShow(true))return false;var d=$(a).attr("id")+"body",c="<textarea class='rte' id='"+d+"'></textarea>";$.ajax({type:"POST",async:false,url:ForumsRes.get_editorUrl,data:{Id:$(a).attr("id")},success:function(a){c=a}});c=c.replace("if (!$.browser.msie || ($.browser.msie && $.browser.version >= 9))","if (!$.browser.msie || ($.browser.msie && $.browser.version >= 9 && document.documentMode >= 9))");var b="<div class='editor'><form>"+c+"<input type='hidden' name='attachmentIds'/></form><div class='commands'><button name='submit'>"+ForumsRes.rte_submitText+"</button><button name='cancel'>"+ForumsRes.rte_cancelText+"</button>";if(userEmailConfigured)b=b+"&nbsp;<input type='checkbox' name='subscribe' "+Forums.Message.autoSubscribeValue(a)+"/><label>"+ForumsRes.rte_subscribeText+"</label>";b+="<div><div class='submitReplyError ajaxerror'></div></div>";b=b+"</div></div>";$(a).append(b);Forums.Rte.show();$("button[name='submit']",a).click(Forums.Message.submitReply(a,$(this).attr("url")));$("button[name='cancel']",a).click(function(){Forums.Rte.hide();$("#"+d).data("tEditor")!==undefined&&$("#"+d).data("tEditor").window.focus();$("div.editor",a).remove()});$("button[name='submit']",a).get(0).scrollIntoView(false);return false})},quote:function(){var a=$(this).parents("li.message");$(this).click(function(){if(!Forums.Rte.canShow(true))return false;var g=$(a).attr("id")+"body",i="<textarea class='rte' id='"+g+"'></textarea>",e=$("div.body",a);e=e.clone();Forums.Rte.UnPrettifyCodeBlocks(e);var b=$(e).html(),d="<blockquote>",f="</blockquote>";if(b.substring(0,d.length)===d){b=b.replace(d,"<p>");var h=b.lastIndexOf(f);b=b.substring(0,h)+"</p>"+b.substring(h+f.length)}b=d+b+f+"<br/>";$.ajax({type:"POST",async:false,url:ForumsRes.get_editorUrl,data:{Id:$(a).attr("id"),body:b},success:function(a){i=a}});var j=$("div.helpful",a),c="<div class='editor'><form>"+i+"<input type='hidden' name='attachmentIds' value='' /></form><div class='commands'><button name='submit'>"+ForumsRes.rte_submitText+"</button><button name='cancel'>"+ForumsRes.rte_cancelText+"</button>";if(userEmailConfigured)c=c+"&nbsp;<input type='checkbox' name='subscribe' "+Forums.Message.autoSubscribeValue(a)+"/><label>"+ForumsRes.rte_subscribeText+"</label>";c=c+"</div></div>";$(a).append(c);Forums.Rte.show();$("button[name='submit']",a).click(Forums.Message.submitReply(a,$(this).attr("url")));$("button[name='cancel']",a).click(function(){Forums.Rte.hide();$("#"+g).data("tEditor")!==undefined&&$("#"+g).data("tEditor").window.focus();$("div.editor",a).remove()});$("button[name='submit']",a).get(0).scrollIntoView(false);return false})},submitEdit:function(a,b){return function(){var e=$("div.editor",a),h=$(a).attr("id")+"body",c=$("#"+h),d=c[0].nodeName.toLowerCase();if(d==="table"&&c.data("tEditor")===undefined)return false;$("div.editor button",a).attr("disabled","disabled");var f=d==="table"?c.data("tEditor").value():c.val();if($("#trustedU").val().toLowerCase()==="false"&&$("#isTrustedCheckEnabled").val().toLowerCase()==="true"&&!Forums.Rte.isUnTrustedUserPostValid(f)){alert(ForumsRes.MessageBodyUnTrustedUser);$("button[name='submit']",a).attr("disabled",false);$("button[name='cancel']",a).attr("disabled",false);return false}if(!Forums.Rte.isBodyLengthValid(f)){$("button[name='submit']",a).attr("disabled",false);$("button[name='cancel']",a).attr("disabled",false);return false}$(e).append('<div class="submitting"></div>');$(e).addClass("submitting");var i=$("div.editor > div.commands > input[name='reason']",a).val(),g=$("div.editor input[name='attachmentIds']",a).attr("value");$.ajax({type:"POST",url:b,data:{__RequestVerificationToken:Forums.Message.AddAntiForgeryToken(),body:f,reason:i,attachmentIds:g},success:function(b){if(typeof b=="object"&&b.StatusCode=="500")Forums.Common.ShowPrompt(b.Message,b.Confirm,b.Redirect);else{Forums.Rte.hide();d==="table"&&c.data("tEditor").window.focus();$("div.editor",a).remove();$(a).after(b).next().hide().fadeIn("fast").each(Forums.Message.decorateMessage);prettyPrint();$(a).remove()}},error:function(b){$("div.submitting",e).remove();$("div.editor button",a).removeAttr("disabled");alert(b.responseText)}})}},submitReply:function(a,b){return function(){var e=$("div.editor",a),h=$(a).attr("id")+"body",c=$("#"+h),d=c[0].nodeName.toLowerCase();if(d==="table"&&c.data("tEditor")===undefined)return false;$("div.editor button",a).attr("disabled","disabled");var f=d==="table"?c.data("tEditor").value():c.val();if($("#trustedU").val().toLowerCase()==="false"&&$("#isTrustedCheckEnabled").val().toLowerCase()==="true"&&!Forums.Rte.isUnTrustedUserPostValid(f)){alert(ForumsRes.MessageBodyUnTrustedUser);$("button[name='submit']",a).attr("disabled",false);$("button[name='cancel']",a).attr("disabled",false);return false}if(!Forums.Rte.isBodyLengthValid(f)){$("button[name='submit']",a).attr("disabled",false);$("button[name='cancel']",a).attr("disabled",false);return false}$(e).append('<div class="submitting"></div>');$(e).addClass("submitting");var g=$("div.editor input[name='attachmentIds']",a).attr("value"),i=$("div.editor > div.commands > input[name='subscribe']",a).is(":checked");$.ajax({type:"POST",url:b,data:{__RequestVerificationToken:Forums.Message.AddAntiForgeryToken(),body:f,attachmentIds:g,subscribe:i},success:function(b){if(typeof b=="object"&&b.StatusCode=="500")Forums.Common.ShowPrompt(b.Message,b.Confirm,b.Redirect);else{Forums.Rte.hide();d==="table"&&c.data("tEditor").window.focus();$("div.editor",a).remove();$(a).after(b).next().hide().fadeIn("fast").addClass("new").each(Forums.Message.decorateMessage);prettyPrint()}},error:function(b){$("div.submitting",e).remove();$("div.editor button",a).removeAttr("disabled");$("div.submitReplyError").html(b.responseText).show()}})}},messageAction:function(a,b){return function(){var c=$(a).parents("li.message"),d=$(c).attr("id");$(c).append('<div class="submitting"></div>');$(c).addClass("submitting");b.__RequestVerificationToken=Forums.Message.AddAntiForgeryToken();if($(a).attr("url"))url=$(a).attr("url");else url=$(a).attr("href");$.ajax({type:"POST",url:url,data:b,success:function(b){if($(a).find(".messageContentContainer").length==0){$("li.message[id='"+d+"']").replaceWith(b);$("li.message[id='"+d+"']").each(Forums.Message.decorateMessage)}else{var a=$("li.message[id='"+d+"']"),f=$(b).find(".messageContentContainer").html(),e=$(b).closest("li.message[id='"+d+"']").attr("class");$(a).find(".messageContentContainer").html(f);$(a).each(Forums.Message.decorateMessage);e&&$(a).attr("class",e);$(c).removeClass("submitting")}},error:function(a){$("div.submitting",c).remove();alert(a.responseText)}});return false}},promptAction:function(a,c,b){return function(){Forums.HTML.createPopup(c);$("#okButton").click(function(){b.reason=$("#reason").attr("value");Forums.Message.messageAction(a,b)();var c=$(a).parents("li.message");$(".menu.message",c).get(0).scrollIntoView(false);$("#mask, .window").hide()});$("#reason").keypress(function(a){a.which==13&&$("#okButton").click()});$("#cancelButton").click(function(){var b=$(a).parents("li.message");$(".menu.message",b).get(0).scrollIntoView(false);$("#mask, .window").hide()});$("#closeButton").click(function(){var b=$(a).parents("li.message");$(".menu.message",b).get(0).scrollIntoView(false);$("#mask, .window").hide()});return false}},answer:function(){$(this).click(Forums.Message.messageAction($(this),{isAnswer:true}))},unanswer:function(){$(this).click(Forums.Message.messageAction($(this),{isAnswer:false}))},proposeAnswer:function(){$(this).click(Forums.Message.messageAction($(this),{isProposed:true}))},unproposeAnswer:function(){$(this).click(Forums.Message.messageAction($(this),{isProposed:false}))},clearAbuse:function(){$(this).click(Forums.Message.promptAction(this,ForumsRes.prompt_clearAbuseReason,{isAbuse:false}))},reportAbuse:function(){$(this).click(Forums.Message.promptAction(this,ForumsRes.prompt_reportAbuseReason,{isAbuse:true}))},deleteMessage:function(){$(this).click(Forums.Message.promptAction(this,ForumsRes.prompt_deleteReason,{isDeleted:true}))},undeleteMessage:function(){$(this).click(Forums.Message.promptAction(this,ForumsRes.prompt_undeleteReason,{isDeleted:false}))},gotoUrl:function(){$(this).click(function(){window.location=$(this).attr("url")});return false},voteHelpful:function(){var a=$(this);$(this).click(function(){$(a).fadeOut("fast");var b=$(a).parents("li.message");$("div.helpful > span > img",b).addClass("submitting");$.ajax({type:"POST",url:$(a).attr("href"),data:{__RequestVerificationToken:Forums.Message.AddAntiForgeryToken(),isHelpful:true},dataType:"json",success:function(a){$("div.helpful > span > span",b).text(a.Votes);$("div.helpful > span > img",b).removeClass("submitting")},error:function(a){$("div.helpful > span > img",b).removeClass("submitting");alert(a.responseText)}});return false})},voteUp:function(){$(this).click(Forums.Message.messageAction($(this),{isHelpful:true}))},voteDown:function(){$(this).click(Forums.Message.messageAction($(this),{isHelpful:false}))},decorateMessage:function(){if(typeof pageData=="undefined"||pageData==null||pageData.validUser==false){var b=$("div.menu.message",this);$("a[name='reply']",b).each(Forums.Message.gotoUrl);$("a[name='quote']",b).each(Forums.Message.gotoUrl);$("div.helpful a.vote",this).each(Forums.Message.gotoUrl);return}$("a[name='reportAbuse']",this).each(Forums.Message.reportAbuse);$("a[name='clearAbuse']",this).each(Forums.Message.clearAbuse);$("div.helpful a.vote",this).each(Forums.Message.voteHelpful);$("a[name='voteup']",this).each(Forums.Message.voteUp);$("a[name='votedown']",this).each(Forums.Message.voteDown);var a=$("div.menu.message",this);$("a[name='setAnswer']",a).each(Forums.Message.answer);$("a[name='unsetAnswer']",a).each(Forums.Message.unanswer);$("a[name='proposeAnswer']",a).each(Forums.Message.proposeAnswer);$("a[name='unproposeAnswer']",a).each(Forums.Message.unproposeAnswer);$("a[name='reply']",a).each(Forums.Message.reply);$("a[name='quote']",a).each(Forums.Message.quote);$("a[name='edit']",a).each(Forums.Message.edit);$("a[name='delete']",a).each(Forums.Message.deleteMessage);$("a[name='undelete']",a).each(Forums.Message.undeleteMessage);$("a[name='split']",a).each(Forums.Message.gotoUrl);$("a.popup",this).popup();var c=Forums.Homepage.getChildIdList("#ReportAbusePopup","li");$("#ReportAbuse").attr("aria-owns",c)},AddAntiForgeryToken:function(){return $("#__AjaxAntiForgeryForm input[name='__RequestVerificationToken']").attr("value")}};Forums.HTML={createPopup:function(c){if($("#boxes").length>0){$("#mask").remove();$("#dialog").remove();$("#boxes").remove()}var b="";if(c===ForumsRes.prompt_deleteReason)b="<div style='padding: 0px 5px 10px 5px;margin-top: 15px;'><label for='cbox'>Report spam or advertising</label><input type='checkbox' id='cbox' value='checkbox'></div>";var f="<div id='boxes'><div id='dialog' class='window'><div class='poupTitle'><label id='resonLabel'>"+c+"</label><img title='Close' id='closeButton' class='icon delete' src=\""+ForumsRes.url_transGif+"\" complete='complete' ></img></div><div style='padding:0px 5px 10px 5px;'><span class='textSpan'><input type='text' id='reason' name='reason' value='' /></span><span class='buttonSpan'><button id='okButton' name='ok' >"+ForumsRes.rte_OKText+"</button><button id='cancelButton' name='cancel' > "+ForumsRes.rte_cancelText+"</button></span></div>"+b+"</div><div id='mask'></div></div>";$("body").append(f);var a="#dialog",e="#mask";$("#reason").select();$("#reason").focus();var g=($(window).height()-$(a).height())/2+$(window).scrollTop(),d=($(window).width()-$(a).width())/2+$(window).scrollLeft();$(a).css({top:g,left:d>0?d:0,display:"block"});this.addAnimation(a);$(e).css({top:0,left:0,width:$(document).width(),height:$(document).height()});$(e).fadeTo("fast",.5)},addAnimation:function(a){$(window).resize(function(){var c=($(window).height()-$(a).height())/2+$(window).scrollTop(),b=($(window).width()-$(a).width())/2+$(window).scrollLeft();$(a).css({top:c,left:b>0?b:0})});$(window).scroll(function(){var c=($(window).height()-$(a).height())/2+$(window).scrollTop(),b=($(window).width()-$(a).width())/2+$(window).scrollLeft();$(a).css({top:c,left:b>0?b:0})})}};Forums.Thread={threadAction:function(a,b){return function(){$("img.icon",a).addClass("submitting");b.__RequestVerificationToken=Forums.Message.AddAntiForgeryToken();if($(a).attr("url"))url=$(a).attr("url");else url=$(a).attr("href");$.ajax({type:"POST",url:url,data:b,dataType:"json",success:function(a){window.location=a.url},error:function(b){$("img.icon",a).removeClass("submitting");alert(b.responseText)}});return false}},promptAction:function(b,c,a){return function(){Forums.HTML.createPopup(c);$("#okButton").click(function(){if(a.stickyDate==""){var c=$("#reason").attr("value");if(Forums.Thread.isStickyDateValid(c))a.stickyDate=$("#reason").attr("value");else{$("#reason").val("");alert(ForumsRes.StickyDateInValid);return false}}else a.reason=$("#reason").attr("value");if($("#cbox").attr("checked")==="checked")a.reason+="[SpamOrAdvertising]";Forums.Thread.threadAction(b,a)();var d=$(b).parents("li.message.root");$(".menu.thread",d).get(0).scrollIntoView(false);$("#mask, .window").hide()});$("#reason").keypress(function(a){a.which==13&&$("#okButton").click()});$("#cancelButton").click(function(){var a=$(b).parents("li.message.root");$(".menu.thread",a).get(0).scrollIntoView(false);$("#mask, .window").hide()});$("#closeButton").click(function(){var a=$(b).parents("li.message.root");$(".menu.thread",a).get(0).scrollIntoView(false);$("#mask, .window").hide()});return false}},AddAntiForgeryToken:function(){return $("#__AjaxAntiForgeryForm input[name='__RequestVerificationToken']").attr("value")},editThread:function(){var a=$(this).parents("li.message");$(this).click(function(){if(!Forums.Rte.canShow(true))return false;var c=$(a).attr("id")+"body",d="<textarea class='rte' id='"+c+"'></textarea>",g=$("#content h1 span[name='subject']").text(),b=$("div.body",a);Forums.Rte.UnPrettifyCodeBlocks(b);var e=$("#"+$(a).attr("id")+"_attachments").attr("value"),h=$(b).html()+"<br/>";$.ajax({type:"POST",async:false,url:ForumsRes.get_editorUrl,data:{Id:$(a).attr("id"),body:h},success:function(a){d=a}});$(b).hide();$("div.helpful, ul.history, div.abusive, div.menu,div.votingouterbox, div.voting,span.votinglabel",a).hide();var f="<div class='editor'><label>"+ForumsRes.rte_subjectLabel+"</label> <input type='text' id='subject' size='60' /><form>"+d+"<input type='hidden' name='attachmentIds' value='"+e+"'/></form><div class='commands'><button id='submit'>"+ForumsRes.rte_submitText+"</button><button id='cancel'>"+ForumsRes.rte_cancelText+"</button>&nbsp;<label>"+ForumsRes.rte_reasonLabel+"</label><input type='text' id='reason'/></div><div><div class='submitEditError ajaxerror'></div></div></div>";$(b).after(f);$("#subject",a).val(g);Forums.Rte.show();$("#submit",a).click(Forums.Thread.submitEdit(a,$(this).attr("url")));$("#cancel",a).click(function(){Forums.Rte.hide();$("#"+c).data("tEditor")!==undefined&&$("#"+c).data("tEditor").window.focus();$("div.editor",a).remove();$(b).show();$("div.helpful, ul.history, div.abusive, div.menu,div.votingouterbox, div.voting,span.votinglabel",a).show();prettyPrint()});$("#submit",a).get(0).scrollIntoView(false);return false})},submitEdit:function(a,b){return function(){var g=$("div.editor"),f=$("div.editor",a),i=$(a).attr("id")+"body",c=$("#"+i),e=c[0].nodeName.toLowerCase();if(e==="table"&&c.data("tEditor")===undefined)return false;g.find("button").attr("disabled","disabled");var d=e==="table"?c.data("tEditor").value():c.val();if($("#trustedU").val().toLowerCase()==="false"&&$("#isTrustedCheckEnabled").val().toLowerCase()==="true"&&!Forums.Rte.isUnTrustedUserPostValid(d)){alert(ForumsRes.MessageBodyUnTrustedUser);$("#submit",a).attr("disabled",false);$("#cancel",a).attr("disabled",false);return false}if(!Forums.Rte.isBodyLengthValid(d)){$("#submit",a).attr("disabled",false);$("#cancel",a).attr("disabled",false);return false}if(!Forums.Rte.isBodyImageCountValid(d)){alert(ForumsRes.rte_MaxAttachmentsErrMsg);$("#submit",a).attr("disabled",false);$("#cancel",a).attr("disabled",false);return false}$(f).append('<div class="submitting"></div>');$(f).addClass("submitting");var k=g.find("#reason").val(),j=g.find("#subject").val(),h=$("div.editor input[name='attachmentIds']",a).attr("value");$.ajax({type:"POST",url:b,data:{__RequestVerificationToken:Forums.Message.AddAntiForgeryToken(),subject:j,body:d,reason:k,attachmentIds:h},dataType:"json",success:function(b){if(typeof b=="object"&&b.StatusCode&&b.StatusCode=="500")Forums.Common.ShowPrompt(b.Message,b.Confirm,b.Redirect);else{e==="table"&&c.data("tEditor").window.focus();$("div.editor",a).remove();window.location=b.url}},error:function(b){$("div.submitting",f).remove();$("div.editor button",a).removeAttr("disabled");$("div.submitEditError").html(b.responseText).show()}})}},clearSticky:function(){$(this).click(Forums.Thread.threadAction(this,{stickyDate:""}))},deleteThread:function(){$(this).click(Forums.Thread.promptAction(this,ForumsRes.prompt_deleteReason,{isDeleted:true}))},lock:function(){$(this).click(Forums.Thread.threadAction(this,{isLocked:true}))},makeSticky:function(){$(this).click(Forums.Thread.promptAction(this,ForumsRes.prompt_stickyUntil,{stickyDate:""}))},subscribe:function(){$(this).click(Forums.Thread.threadAction(this,{isSubscribed:true}))},undeleteThread:function(){$(this).click(Forums.Thread.promptAction(this,ForumsRes.prompt_undeleteReason,{isDeleted:false}))},unlock:function(){$(this).click(Forums.Thread.threadAction(this,{isLocked:false}))},unsubscribe:function(){$(this).click(Forums.Thread.threadAction(this,{isSubscribed:false}))},join:function(){$(this).click(Forums.Thread.threadAction($(this),{isJoined:true}))},unjoin:function(){$(this).click(Forums.Thread.threadAction($(this),{isJoined:false}))},decorateThreadMenu:function(){$("a[name='delete']",this).each(Forums.Thread.deleteThread);$("a[name='undelete']",this).each(Forums.Thread.undeleteThread);$("a[name='editThread']",this).each(Forums.Thread.editThread);$("a[name='lock']",this).each(Forums.Thread.lock);$("a[name='unlock']",this).each(Forums.Thread.unlock);$("a[name='sticky']",this).each(Forums.Thread.makeSticky);$("a[name='clearSticky']",this).each(Forums.Thread.clearSticky);$("a[name='subscribe']",this).each(Forums.Thread.subscribe);$("a[name='unsubscribe']",this).each(Forums.Thread.unsubscribe);$("a[name='joinQuestion']").each(Forums.Thread.join);$("a[name='unJoinQuestion']").each(Forums.Thread.unjoin);$("a[name='move']").each(Forums.Message.gotoUrl);$("a[name='merge']").each(Forums.Message.gotoUrl);$("a[name='assign']").each(Forums.Message.gotoUrl);$("a[name='changeType']").each(Forums.Message.gotoUrl)},messagesLoaded:function(a){$(a).removeClass("loading");$(a).removeClass("hasUnread");$(a).removeClass("new");$(a).addClass("loaded");$(a).addClass("viewed");$("div.preview",a).append('<div class="links"></div>');var b=$("div.links",a);$(b).append('<a name="view"></a>');var e=$("a[name='view']",b),d=$("h3 a:eq(1)",a).attr("href");$(e).text(ForumsRes.thread_viewThreadText).attr("href",d).attr("title",ForumsRes.thread_viewThreadText);$(b).append('<a name="close"></a>');var c=$("a[name='close']",b);$(c).text(ForumsRes.thread_closePreviewText).attr("href","javascript:void(0)").attr("title",ForumsRes.thread_closePreviewText);$(c).click(function(){$("h3",a).click()});$("div.preview",a).slideToggle("fast");$("li.message",a).each(Forums.Message.decorateMessage);prettyPrint()},decorateThread:function(){var a=$(this);$("h3 > a",this).before(Forums.Constants.ExpandCollapseLink);$(this).append('<div class="preview"></div>');$("h3",this).click(function(c){if(c.target.nodeName.toLowerCase()==="a")if(c.target.className!=="expcol")return;$(a).toggleClass("expanded");if($(a).hasClass("loading"))return;if($(a).hasClass("loaded")){$("div.editor button[name='cancel']",a).click();$("div.preview",a).slideToggle("fast");return}$(a).addClass("loading");var b=$("h3:first > a:eq(1)",a).attr("href")+"/messages?time="+(new Date).getTime();b=b.substring(7);b=b.substring(b.indexOf("/"));$("div.preview",a).load(b,null,function(){Forums.Thread.messagesLoaded(a);$("li.message",this).profileWidgitize()})});$("h3",this).mouseover(function(){$(a).addClass("hover")});$("h3",this).mouseout(function(){$(a).removeClass("hover")})},isStickyDateValid:function(c){if(c.length!=10)return false;var a=c.split("-");if(a.length!=3)return false;var e="^[0-9]+$";for(i=0;i<3;i++)if(!a[i].match(e))return false;var b=new Date(a[0],a[1]-1,a[2]);if(b.getFullYear()!=a[0]||b.getMonth()!=a[1]-1||b.getDate()!=a[2])return false;var d=new Date;return b<d?false:true}};Forums.QuickLinks={wire:function(){$("#quickLinks").click(function(a){Forums.Common.SubmitMetricsToAI("Homepage.QuickAccessExpanded");Forums.Homepage.toggleDropDown($(this),a)});$("ul.popup li > a","#quickLinks").click(function(a){return Forums.Common.SubmitMetricsToAIAndRedirect("Homepage.QuickAccesLinkClicked",{linkId:$(this).attr("Id")},$(this).attr("href"),a.ctrlKey)});$("#quickLinks").keypress(function(a){a.which==13&&$("#quickLinks").click()});var a=Forums.Homepage.getChildIdList("#quickAccessPopup","li");$("#quickLinks").attr("aria-owns",a)}};Forums.MyActivityWidget={wire:function(){$("#myThreadAllLink").live("click",function(a){return Forums.Common.SubmitMetricsToAIAndRedirect("MyActivity.MyThreadClicked",null,$(this).attr("href"),a.ctrlKey)});$("#myThreadAnsweredLink").live("click",function(a){return Forums.Common.SubmitMetricsToAIAndRedirect("MyActivity.MyThreadAnsweredClicked",null,$(this).attr("href"),a.ctrlKey)});$("#myThreadUnansweredLink").live("click",function(a){return Forums.Common.SubmitMetricsToAIAndRedirect("MyActivity.MyThreadUnansweredClicked",null,$(this).attr("href"),a.ctrlKey)});$("#myThreadUnreadLink").live("click",function(a){return Forums.Common.SubmitMetricsToAIAndRedirect("MyActivity.MyThreadUnreadClicked",null,$(this).attr("href"),a.ctrlKey)})}};Forums.Homepage={Actions:{Category:0,CategoryAll:1,CategoryViewAll:2,Filter:5,Sort:6,Search:7,Clear:8,FilterWithAllLanguages:9},wireTopBar:function(a){Forums.Homepage.searchWatermark=a;Forums.Homepage.wireFilterBar(a);Forums.ThreadPage.wireSearchBar(a);Forums.QuickLinks.wire();Forums.MyActivityWidget.wire()},wirePageElements:function(a){Forums.Homepage.wireThreadListView();Forums.Homepage.wireCategoryList();Forums.Homepage.wireTagsList();Forums.ForumDetails.wireForumDetailLinks();Forums.Homepage.wireAnnouncements();Forums.Homepage.wireActivitySidebarSection();Forums.ThreadPage.attachTooltipHandler();Forums.Homepage.categoriesWatermark=a;$.addToRail(railItems);Forums.Homepage.loadAllCategories();$(".btn.askQuestionLink").click(function(a){Forums.Common.SubmitMetricsToAIAndRedirect("Homepage.AskAQuestionClicked",{linkhref:$(this).attr("href")},$(this).attr("href"),a.ctrlKey);return false})},rewirePageElements:function(){Forums.Toggler.setup();Forums.Homepage.wirePageElements(Forums.Homepage.categoriesWatermark,Forums.Homepage.searchWatermark)},rewireSearchElements:function(){Forums.Toggler.wireToggleButton();Forums.Homepage.wireFilterBar(Forums.Homepage.searchWatermark);Forums.Homepage.wireTagsList(Forums.Homepage.searchQuestionswatermark);Forums.ForumDetails.wireForumDetailLinks();Forums.Homepage.replaceSearchUrl();Forums.Homepage.replaceAnnouncements();Forums.Homepage.wireAnnouncements();Forums.Homepage.wireThreadListView();Forums.Homepage.addSelectedClassToSelectedCategoryHeaders();Forums.ThreadPage.attachTooltipHandler()},replaceAnnouncements:function(){$("#topBarImportantInfoContainer").html($("#searchAnnouncmentContainer").html())},replaceSearchUrl:function(){$("#homesearchform").attr("action",$("#hdnSearchUrl").val())},loadAllCategories:function(){var a=$("#allCategoryPopupContainer"),c=($(window).width()-a.width())/2;$(a).css("left",c);if($("#allCategoryListContainer",$(a)).length==0){var b=$(a).data("url");b=Forums.AppendQuestionOrAmpersandToUrl(b)+"time="+(new Date).getTime();$.ajax({url:b}).done(function(c){$("#allCategoryPopupContainer").html(c);Forums.Homepage.wireGetAllCategories();var b=$(window).height()*.8-160;$("#categoriesListing").children("ul").height(b<400?b:400);var d=($(window).height()-a.height())/2;$(a).css("top",d);Forums.Homepage.setAllCategoriesSelectedItems()})}else Forums.Homepage.setAllCategoriesSelectedItems()},wireGetAllCategories:function(){Forums.Homepage.wireAllCategoriesBox(Forums.Homepage.categoriesWatermark);c();$("#submitAllCategories").click(function(a){Forums.Common.SubmitMetricsToAI("Homepage.AllForumsPopupSubmitClicked");b(a)});$("#closeAllCategoryPopup").click(function(b){Forums.Common.SubmitMetricsToAI("Homepage.AllForumsPopupCloseLinkClicked");a(b)});$("#closeAllCategoryPopup").keydown(function(a){a.keyCode==13&&$("#viewallCategoriesContainer").trigger("click")});Forums.Homepage.wireCategoryListElements($("#allCategoryPopupContainer"));Forums.Homepage.setAllCategoriesSelectedItems();$("#allCategoryListContainer").find(".selectallcheckbox").change(function(){Forums.Homepage.selectAllForums($(this));Forums.Homepage.updateSelectedForumsCount()});$("#allCategoryListContainer").find('input[type="checkbox"]').change(function(){$("#allCategoriesListChanged").val(true);Forums.Homepage.updateSelectedForumsCount()});Forums.Homepage.updateSelectedForumsCount();function c(){$("#searchbox","#allCategoriesSearchContainer").click(function(){Forums.Common.SubmitMetricsToAI("Homepage.AllForumsPopupSearchBoxClicked")});$("#allCategoriesSearchContainer").find("#searchbox").bind("input keyup",function(){Forums.Homepage.handleSearchBoxChanged(this,d)})}function b(b){if($("#allCategoriesListChanged").val()=="true")Forums.Homepage.redirectHomePage($("#allCategoryListContainer"),$("#homePageFilterBarContainer"),Forums.Homepage.searchWatermark,Forums.Homepage.Actions.CategoryViewAll);else a(b)}function a(a){Forums.Homepage.hideDropDown(a);$("#viewallCategoriesContainer").find(".arrowdown").addClass("invisible").removeClass("visible");a.stopPropagation()}function d(a){if(Forums.Rte.trimString(a)!=="")$("#allCategoryPopupContainer").find(".categoryArea").each(function(){var c=$(this).find(".forumFilter"),d=$(this).find(".categoryHeaderText:first").html(),e=d.toUpperCase().indexOf(a.toUpperCase())!==-1,b=$(this).find(".checkboxText:Contains('"+a+"')");if(e){$(c).find(".forumItem").show();$(this).show()}else{$(b).each(function(){$(this).parents(".forumItem:first").show()});$(this).find(".checkboxText:not(:Contains('"+a+"'))").each(function(){$(this).parents(".forumItem:first").hide()});$(this).toggle(b.length>0)}if(b.length>0)Forums.Homepage.showForumList(c);else Forums.Homepage.hideForumList(c)});else{$("#allCategoryPopupContainer").find(".categoryArea").show();$("#allCategoryPopupContainer").find(".forumFilter").each(function(){Forums.Homepage.hideForumList($(this))});$("#allCategoryPopupContainer").find(".forumFilter:has(.chkForumSelector:checked)").each(function(){Forums.Homepage.showForumList($(this))});$("#allCategoryPopupContainer").find(".forumItem").show()}}},handleSearchBoxChanged:function(a,c){a=$(a);window.clearTimeout(a.data("refresh_timer"));var b="";if(!a.hasClass("watermark"))b=a.val();a.data("refresh_timer",setTimeout(function(){c(b)},500));return false},setAllCategoriesSelectedItems:function(){Forums.Homepage.setCategoryScopingState("#allCategoryListContainer");Forums.Homepage.updateSelectedForumsCount()},wireAskAQuestion:function(d){var c=$(".btn.askQuestionLink","#msdn-technet-en-home"),a="",b="",e=$(c).data("askurlbase");if(d.length===1){b=d[0];a=$(".categoryHeader.selected:first").parents("li.categoryArea:first").data("categoryname")}var f=e+"?category="+a+"&forum="+b;$(c).attr("href",f)},wireThreadListView:function(){$(".pager a","#threadList").click(function(a){Forums.ScrollWindowToTop();Forums.Common.SubmitMetricsToAIAndRedirect("Homepage.ClickedThreadListPagerLink",{linkid:$(this).attr("id")},$(this).attr("href"),a.ctrlKey);return false});$("a.arrowdown",".threadsnippet").click(function(){Forums.Common.SubmitMetricsToAI("Homepage.ThreadSnippetExpanded");Forums.Homepage.expandThread($(this))});$(".statefilter a").click(function(){var b=$(this).text();Forums.Common.SubmitMetricsToAI("Homepage.ThreadMetadataStateFilterClicked",{state:b});var a={};a.Answered="Answered";a.Unanswered="Unanswered";a.Proposed="Proposed answers";a.Discussion="General discussion";$(".radioButtonText").filter(function(){return $(this).text()==a[b]}).click()});var a=$("a.arrowdown",".threadsnippet.selected");$(a).length>0&&$(a).click()},wireAllCategoriesBox:function(a){$("#allCategoryListContainer").find(".forumItem").mouseover(function(){var a=$(this).parents(".categoryArea:first").data("categoryname");Forums.Homepage.loadForumDetails(a,$(this).data("forumname"))});$("#allCategoriesSearchContainer table.searchboxinnercontainer #searchbox").watermark(a)},wireCategoryListElements:function(a){var b="expanded";$(".categoryHeader",a).click(function(){Forums.Common.SubmitMetricsToAI("Homepage.CategoryExpanded");var a=$("a.arrowdown",$(this));c($(a));return false});$(".categoryHeader").keydown(function(a){a.keyCode==13&&$(".categoryHeader").trigger("click")});$(".forumFilter .checkboxText",a).click(function(){var a=$(this).siblings(".checkboxContainer").children("input[type='checkbox']");$(a).attr("checked",!$(a).attr("checked")).change()});function c(c){var e=$(c).parents(".categoryHeader",a).siblings(".forumFilter"),d=$(c).hasClass(b);$(e).toggle(!d);$(c).toggleClass(b)}},wireCategoryList:function(){$("#viewallCategoriesContainer").keydown(function(a){a.keyCode==13&&$("#viewallCategoriesContainer").trigger("click")});$("#viewallCategoriesContainer").click(function(c){Forums.Common.SubmitMetricsToAI("Homepage.ViewAllForumsLinkClicked");var a=$("#allCategoryPopupContainer");if($("#categoryOverlay").length<=0&&!($.browser.msie&&parseInt($.browser.version,10)<=7)){var b=$('<div id="categoryOverlay" class="popupOverlay"/>');b.css("height",$(document.body).height());$("body").append(b)}$("#allCategoriesListChanged").val(false);Forums.Homepage.loadAllCategories();a.data("overlay","#categoryOverlay");a.data("isModal",true);Forums.Homepage.toggleDropDown($(a).parent(),c);$("#categoryPopupClose").focus();var d=$("input[name='searchTerm']:eq(1)").attr("watermark");$("input[name='searchTerm']:eq(1)").attr("aria-label",d)});$(".categoryArea").has(".chkForumSelector:checked").each(function(){$(this).find(".categoryHeader").addClass("selected")});Forums.Homepage.addSelectedClassToSelectedCategoryHeaders()},addSelectedClassToSelectedCategoryHeaders:function(){$(".categoryHeader").removeClass("selected");$(".categoryArea").has(".chkForumSelector:checked").each(function(){$(this).find(".categoryHeader").addClass("selected")})},setCategoryScopingState:function(a){$("input[type='checkbox']",a).attr("checked",false);b();c();function d(a){var b=$(".chkForumSelector:not(:checked)",a).length==0;$(".selectallcheckbox",$($(a))).attr("checked",b)}function c(){var b=Forums.Homepage.getCurrentForums();$(b).each(function(){var c=$("div[data-forumname='"+this+"'].forumItem:first",a);$(".chkForumSelector",c).attr("checked",true);var b=$(c).parents(".forumFilter");if(!$(b).is(":visible"))Forums.Homepage.showForumList(b);else d(b)})}function b(){$(".forumFilter","#allCategoryListContainer").each(function(){Forums.Homepage.hideForumList($(this))})}},showForumList:function(a){Forums.Homepage.hideorShowForumList(a,true)},hideForumList:function(a){Forums.Homepage.hideorShowForumList(a,false)},hideorShowForumList:function(a,b){$(a).toggle(b);var c=$(a).siblings(".categoryHeader").find(".arrowdown");$(c).toggleClass("expanded",b)},updateSelectedForumsCount:function(){$("#totalselectedForums").html(" "+$("#categoriesListing input:checked").not(".selectallcheckbox").length+" ")},wireTagsList:function(){$(".forumremove").unbind("click").click(function(){var a=$(this).parents(".forumItem:first");$($(".chkForumSelector[data-forumId='"+$(a).data("forumid")+"']")).each(function(){$(this).attr("checked",false)});Forums.Common.SubmitMetricsToAI("Homepage.ForumListRemoveLinkClicked",{forum:$(a).data("forumname")});$(a).remove();Forums.Homepage.redirectHomePageForTags(Forums.Homepage.Actions.Category);return false});$("#clearSelectedTags").unbind("click").click(function(){Forums.Common.SubmitMetricsToAI("Homepage.ClearSelectedTagsLinkClicked");$(".forumItem","#selectedTags").remove();$("#viewMoreTags").remove();$(".chkForumSelector").attr("checked",false);$("#selectedTags").hide();Forums.Homepage.redirectHomePageForTags(Forums.Homepage.Actions.Category);return false});$(".forumtag").unbind("click").on("click",function(){var a=$(this).parent(".tagcontainer");if($(a).hasClass("singledout")){$(".tagcontainer").removeClass("dim").removeClass("singledout");Forums.Homepage.redirectHomePageForTags(Forums.Homepage.Actions.Category)}else{$(".tagcontainer").addClass("dim").removeClass("singledout");$(a).removeClass("dim").addClass("singledout");Forums.ClientRefresh.Controller.get($(this).attr("href"),Forums.Homepage.Actions.Category)}return false});$("#inputTagSearch").click(function(){Forums.Common.SubmitMetricsToAI("Homepage.SearchForumsClicked")});$("#viewMoreTags a").click(function(){Forums.Common.SubmitMetricsToAI("Homepage.ViewMoreTagsClicked",{text:$(this).html()});$(this).remove();$(".forumItem.hiddenItem").removeClass("hiddenItem");return false})},selectTag:function(d,a,e,b,c,f){$("#selectedTags").show();$("#forumItem_"+a).length==0&&$(".tags","#selectedTags").append("<div id='forumItem_"+a+"' class='forumItem' data-categoryname='"+d+"' data-forumname='"+e+"' data-forumid='"+a+"' data-forumdetailsurl='"+c+"'><div class='tagcontainer defaultColor'><a href='"+f+"' class='forumtag'>"+b+"</a><div class='forumremove'><a href='#' class='removeTag' title='"+ForumsRes.SideBar_RemoveText+"'>x</a></div></div><div class='forumDetailsTip'></div></div>");$("#inputTagSearch").val("");$($(".chkForumSelector[data-forumId='"+a+"']")).each(function(){$(this).attr("checked",true)});Forums.Common.SubmitMetricsToAI("Homepage.ForumSelectedFromForumsDropDown",{forum:b,forumId:a});Forums.Homepage.redirectHomePageForTags(Forums.Homepage.Actions.Category)},wireFilterBar:function(){$(".filterdropdown","#filterBar").click(function(a){Forums.Homepage.toggleFilterDropDown($(this),a)});$(".threadFilterItem").find(".chkFilterSelector").change(function(){if($(this).parents(".threadFilterItem:first").data("filter")=="alllanguages"){Forums.Common.SubmitMetricsToAI("Homepage.AllLanguagesSelected");Forums.Homepage.redirectHomePageForTags(Forums.Homepage.Actions.FilterWithAllLanguages)}else{Forums.Common.SubmitMetricsToAI("Homepage.NewFilterSelected",{filter:$(this).attr("id")});Forums.Homepage.redirectHomePageForTags(Forums.Homepage.Actions.Filter)}});$(".threadFilterItem").keypress(function(b){if(b.which==13){var a=$(this).find("input");if(a.attr("checked")!=null)a.removeAttr("checked");else a.attr("checked","checked");$(".threadFilterItem").find(".chkFilterSelector").change();$(this).parent().click()}});$("#threadFilter").find(".checkboxText").click(function(){var a=$(this).siblings("input[type='checkbox']");$(a).attr("checked",!$(a).attr("checked")).change()});$("#threadFilter").keypress(function(a){a.which==13&&$("#threadFilter").click()});$(".radioButtonText").click(function(){var a=$(this).siblings('input[type="radio"]');$(a).attr("checked",!$(a).attr("checked")).change()});$("li.sortSelector").click(function(){$("#sortFilter").find(".selectedSort").each(function(){$(this).removeClass("selectedSort").addClass("unselectedSort")});$(this).removeClass("unselectedSort").addClass("selectedSort");Forums.Common.SubmitMetricsToAI("Homepage.SortSelected",{sort:$(this).attr("id")});Forums.Homepage.redirectHomePageForTags(Forums.Homepage.Actions.Sort)});$("#sortFilter").keypress(function(a){a.which==13&&$("#sortFilter").click()});$("li.sortSelector").keypress(function(a){if(a.which==13){$(this).find("input").attr("checked","checked");$("li.sortSelector").click();$("#sortFilter").click()}});var a=Forums.Homepage.getChildIdList("#ThreadFilterPopup",".threadFilterItem");$("#threadFilter").attr("aria-owns",a);var b=Forums.Homepage.getChildIdList("#SortFilterPopup",".unselectedSort.sortSelector");$("#sortFilter").attr("aria-owns",b)},getChildIdList:function(b,c){var a="";$(b).find(c).each(function(){a+=$(this).attr("id")+" "});return a.trim()},wireActivitySidebarSection:function(){var b=$("#homepageLeaderboard"),a=$("#myActivityWidget");if(a.length===1)Forums.Homepage.loadMyActivityWidget(a);else b.length===1&&Forums.Homepage.loadLeaderBoard(b,1)},wireAnnouncements:function(){$("#seeAnnouncementsLinkBox").click(function(a){Forums.Homepage.toggleDropDown($(this).parent(),a)});$("li.announcement .announcementContainer").click(function(){Forums.Common.SubmitMetricsToAI("Homepage.AnnouncementsClicked");$(this).find("a.arrowdown").toggleClass("expanded");$(this).siblings(".announcementDetails").toggle()});$("li.announcement .linkAnnouncement").click(function(c){c.preventDefault();var a=$(this).parents("li.announcement"),b=$("div.linkContent",$(a));if(b.length>0)b.remove();else{b="<div class='linkContent'> <div style='margin-right: 4px;'><label>"+ForumsRes.Announcement_LinkToAnnouncement+"</label><a class='close' href='javascript:void(0)' style='float:right;'>"+ForumsRes.Announcement_CloseText+"</a></div>  <div><input type='text' class='announcementUrl' readonly='readonly' value='"+$(this).attr("href")+"' /></div>  </div>";$(b).insertBefore($("div.announcementDetails",$(a)));$("a.close",a).click(function(b){b.stopPropagation();$("div.linkContent",a).remove()});$("input[type='text']",a).click(function(a){a.stopPropagation()}).focus()}});$("li.announcement .deleteAnnouncement").click(function(b){b.preventDefault();var a=$(this).parents(".announcement:first");$.ajax({type:"POST",url:$(this).attr("href"),data:{__RequestVerificationToken:Forums.Message.AddAntiForgeryToken(),isDeleted:true},success:function(){$(a).remove()}})});var a=$("#topBarImportantInfoContainer .announcementContainer.selected");if($(a).length>0){$("#seeAnnouncementsLinkBox").click();$(a).click()}},getCurrentForums:function(){var a=[];$(".forumItem","#selectedTags").each(function(){a.push($(this).data("forumname"))});return Forums.GetJSONArray(JSON.stringify(a))},getCurrentCategories:function(){return Forums.GetJSONArray($("#hdnCategories").val())},selectAllForums:function(a){var c=$(a).parents("li.categoryArea:first").data("categoryid"),b=$(a).is(":checked");$(".allForumItems_"+c).find(".chkForumSelector").attr("checked",b);Forums.Common.SubmitMetricsToAI("Homepage.SelectAllChanged",{categoryId:c,selectedValue:b})},getSelectedForums:function(b){var a=[];$(b).find(".chkForumSelector:checked").each(function(){a.push($(this).parents(".forumItem:first").data("forumname"))});return a},ForumCounts:null,setForumCounts:function(a){Forums.Homepage.ForumCounts=a},ForumsAll:null,setForumsAll:function(a){Forums.Homepage.ForumsAll=a},getSelectedForumsAndCategoriesFromTags:function(){var b=[],d=[],e=[],f=false,a={};$(".forumItem","#selectedTags").each(function(){var c=$(this).attr("data-categoryName");if($(a[c]).length==0)a[c]=1;else a[c]=a[c]+1;b.push($(this).data("forumname"))});this.ForumsAll&&$(this.ForumsAll).each(function(a){a.isIrootForum&&e.push(a.forumName)});if($(e).not(b).length==0&&$(b).not(e).length==0){b=[];d=[];f=true}else for(var c in a)if(a[c]==Forums.Homepage.ForumCounts[c]){d.push(c);$(".forumItem[data-categoryname='"+c+"']","#selectedTags").each(function(){Forums.Common.RemoveFromArray(b,$(this).data("forumname"))})}return{selectedForums:b,selectedCategories:d,useDefaultIrootForums:f}},getSelectedForumsWithCategories:function(b){var a={};$(b).find("li.categoryArea").each(function(){var b=$(this).find(".chkForumSelector:checked");if(b.length>0){var e=$(this).find(".chkForumSelector").length,c=[];b.each(function(){c.push($(this).parents(".forumItem:first").data("forumname"))});var d=$(this).data("categoryname");a[d]={totalForums:e,forums:c}}});return a},redirectHomePageForTags:function(i){var b=Forums.Homepage.getSelectedForumsAndCategoriesFromTags();Forums.Homepage.wireAskAQuestion(b.selectedForums);var g=[],d=$("#homePageFilterBarContainer");$(d).find(".chkFilterSelector:checked").each(function(){var a=$(this).parents(".threadFilterItem:first").data("filter");g.push(a)});var h=[];$(d).find("li.selectedSort").each(function(){h.push($(this).data("sort"))});var c=encodeURIComponent($("#threadsearchbarContainer input#searchbox").val()),e=$("#hdnUserName").val(),f=Forums.BaseUrl(),a=f;if(e){a=Forums.AppendQuestionOrAmpersandToUrl(a);a+="user="+e}if(b.selectedCategories.length>0)a=Forums.CommaSeparateAndAddListToUrl(a,"category",b.selectedCategories);if(b.selectedForums.length>0)a=Forums.CommaSeparateAndAddListToUrl(a,"forum",b.selectedForums);a=Forums.CommaSeparateAndAddListToUrl(a,"filter",g);a=Forums.CommaSeparateAndAddListToUrl(a,"sort",h);if(c&&c!=encodeURIComponent(Forums.Homepage.searchWatermark)){a=Forums.AppendQuestionOrAmpersandToUrl(a);a+="searchTerm="+c}if(!b.useDefaultIrootForums&&b.selectedForums.length==0&&b.selectedCategories.length==0){a=Forums.AppendQuestionOrAmpersandToUrl(a);a+="brandIgnore=true";$("#selectedTags").hide()}Forums.Homepage.updateSignInOutLink(f,a);Forums.ClientRefresh.Controller.get(a,i)},redirectHomePage:function(n,f,o,l){Forums.Homepage.addSelectedClassToSelectedCategoryHeaders();b=Forums.Homepage.getSelectedForums($("#categoriesListing"));Forums.Homepage.wireAskAQuestion(b);var h=Forums.Homepage.getSelectedForumsWithCategories(n),b=[],c=[];for(var g in h){var e=h[g];if(e.totalForums==e.forums.length)c.push(g);else b.push.apply(b,e.forums)}var k=[];$(f).find(".chkFilterSelector:checked").each(function(){var a=$(this).parents(".threadFilterItem:first").data("filter");k.push(a)});if(l==Forums.Homepage.Actions.FilterWithAllLanguages){b=Forums.Homepage.getCurrentForums();c=Forums.Homepage.getCurrentCategories()}var m=[];$(f).find("li.selectedSort").each(function(){m.push($(this).data("sort"))});var d=encodeURIComponent($("#threadsearchbarContainer input#searchbox").val()),i=$("#hdnUserName").val(),j=Forums.BaseUrl(),a=j;if(i)a+=(a.indexOf("?")>-1?"&":"?")+"user="+i;if(c.length>0)a=Forums.CommaSeparateAndAddListToUrl(a,"category",c);if(b.length>0)a=Forums.CommaSeparateAndAddListToUrl(a,"forum",b);a=Forums.CommaSeparateAndAddListToUrl(a,"filter",k);a=Forums.CommaSeparateAndAddListToUrl(a,"sort",m);if(d&&d!=encodeURIComponent(o))a+=(a.indexOf("?")>-1?"&":"?")+"searchTerm="+d;if(b.length==0&&c.length==0)a+=(a.indexOf("?")>-1?"&":"?")+"brandIgnore=true";Forums.Homepage.updateSignInOutLink(j,a);Forums.ClientRefresh.Controller.get(a,l)},updateSignInOutLink:function(g,f){var a=$(".scarabLink"),b=a.attr("href"),e=/ReturnUrl=(.+)/gim,c=e.exec(b);if(c!=null){var d=encodeURIComponent(f);a.attr("href",b.replace(c[1],d))}},expandThread:function(a){var b=$(a).parents("div.threadsnippet:first").find("div.expandedThreadContainer"),c=$(a).parent().data("threadmessagesurl");$(a).toggleClass("expanded");$(b).toggle($(a).hasClass("expanded"));$(a).hasClass("expanded")&&Forums.Homepage.loadThreadPreview(b,c)},hideDropDown:function(a){$(".popup").each(function(){if(!$(this).find(a.target).length||$(a.target).hasClass("closePopup")){$(this).hide();$(this).data("overlay")&&$($(this).data("overlay")).hide();if($(this).data("isModal")){var b=$("body");b.removeClass("no-vertical-scrolling");if(typeof $(this).data("originalBodyWidthStyle")!="undefined")document.body.style.width=$(this).data("originalBodyWidthStyle")}}})},toggleDropDown:function(e,c){var a=e.children(".popup"),d=!$(a).is(":visible");Forums.Homepage.hideDropDown(c);if(d){a.data("overlay")&&$(a.data("overlay")).toggle();a.toggle();if(a.data("isModal")){var b=$("body");a.data("originalBodyWidthStyle",document.body.style.width);b.css("width",b.width()+"px");b.addClass("no-vertical-scrolling")}c.stopPropagation();$("body").click(function(a){Forums.Homepage.hideDropDown(a)})}},toggleFilterDropDown:function(a,b){$(".filterdropdown","#filterBar").each(function(){$(a).attr("id")!=$(this).attr("id")&&$(this).children(".popup").hide()});Forums.Homepage.toggleDropDown(a,b)},loadThreadPreview:function(a,b){b=Forums.AppendQuestionOrAmpersandToUrl(b)+"time="+(new Date).getTime();$.ajax({type:"GET",beforeSend:function(){$(a).show()},url:b,success:function(b){$(a).html(b);$("#threadList").addClass("nowhitespace");prettyPrint();$("li.message",a).each(Forums.Message.decorateMessage);$(a).find("a[name='reply']").click(function(){Forums.Common.SubmitMetricsToAI("Homepage.ExpandedThreadReplyClicked")});$(a).find("a.voteuphreflink").click(function(){Forums.Common.SubmitMetricsToAI("Homepage.ExpandedThreadVoteLinkClicked")})},error:function(){$(a).html('<div class="links"></div>');var b=$("div.links",a);$(b).append("<a class='view'></a>");var c=$(a).parent().find("h3 a.threadUrl").attr("href");$("a.view",b).text(ForumsRes.thread_viewThreadText).attr("href",c).attr("title",ForumsRes.thread_viewThreadText);$(b).append("<a class='close'></a>");$("a.close",b).text(ForumsRes.thread_closePreviewText).attr("href","javascript:void(0)").attr("title",ForumsRes.thread_closePreviewText).click(function(){$(a).hide()})}})},loadLeaderBoard:function(b,a){var c=$(b).data("leaderboardurl");a++;if(a>4||a<2)a=2;$(b).addClass("submitting").load(c,"leaderBoard="+a+"&rnd="+Math.random(),function(){$(b).removeClass("submitting");$("a[name='seeMore']").click(function(){Forums.Common.SubmitMetricsToAI("Homepage.LeaderboardNextLinkClicked");Forums.Homepage.loadLeaderBoard($(this).data("nextindex"))})})},loadMyActivityWidget:function(a){var b=$(a).data("contenturl");$(a).addClass("submitting").load(b,"rnd="+Math.random(),function(){$(a).removeClass("submitting")})},loadForumDetails:function(d,c){var b="categoryDetails_"+d;if(!$("#"+b).length){var a=document.createElement("div");$(a).attr("id",b);$("#forumDetailsContainer").append(a);var e=$("#category_"+d).children(".categoryHeader").data("forumdetailsurl");$.getJSON(e,function(b){Forums.Homepage.loadForumDetailsForCategory(b,a,c)}).fail(function(c,b,a){$("#forumDetailsContainer").html("Error: "+a)})}else{$(".singleforumdetails").hide();$("#forumDetailsContainerBanner").hide();$("#forumdetails_"+c).show()}},loadForumDetailsForCategory:function(c,a,b){$.each(c,function(g,b){var c=$("#forumDetailsTemplate").clone().hide();$(c).attr("id","forumdetails_"+b.Name).attr("class","singleforumdetails");$(c).children("h3.header").prepend(b.DisplayName);$(c).children("div.content").html(b.Description);$(c).find("img.rss").parent().attr("href",b.RSSUrl);if(b.ShowManageForums){var e=$(c).find(".manageForumSection");$(e).find(".manageForumLink").attr("href",b.ManageForumUrl).text(b.ManageForumsText);$(e).find(".manageRolesLink").attr("href",b.ManageRolesUrl).text(b.ManageRolesText);$(e).show()}var d=$(c).find("a.addRemoveForum");$(d).attr("href",b.FavoriteUrl);if(b.HasFavoritePermission)$(d).attr("title",b.AddToMyForumsText).attr("name","favorite").attr("data-reverseText",b.RemoveFromMyForumsText).attr("data-reversename","unfavorite").text(b.AddToMyForumsText);else b.HasUnFavoritePermission===true&&$(d).attr("title",b.RemoveFromMyForumsText).attr("name","unfavorite").attr("data-reverseText",b.AddToMyForumsText).attr("data-reversename","favorite").text(b.RemoveFromMyForumsText);$(a).append(c);var f=$(d).attr("name");typeof f!=="undefined"&&f!==false&&$(d).show()});$(".singleforumdetails").hide();$("#forumdetails_"+b).show();$("#forumDetailsContainerBanner").hide();$(a).find("a.addRemoveForum").click(function(){var b=$(this).attr("name")==="favorite",a=$(this);$.post($(a).attr("href"),{isFavorited:b},function(f){if(f.success){var d=$(a).text(),c=$(a).attr("name"),b=$(a).attr("data-reverseText"),e=$(a).attr("data-reversename");$(a).attr("title",b).attr("name",e).attr("data-reverseText",d).attr("data-reversename",c);$(a).text(b)}},"json");return false})},logClick:function(){var a=$(document).find("#hdnQueryId").val(),b=$(document).find("#hdnPage").val(),e=$(this).data("threadid"),f=$(this).data("block"),d=$(this).data("position");if(a&&b){var c={queryId:a,page:b,threadId:e,block:f,position:d};Forums.Common.SubmitMetricsToAIAndRedirect("Homepage.SearchResultClick",c,$(this).attr("href"),event.ctrlKey)}},wireSearchResultEvents:function(){$(".threadUrl").click(Forums.Homepage.logClick);$(".threadstatus").click(function(){Forums.Common.SubmitMetricsToAI("Homepage.ThreadIconClick",{threadId:$(this).parents(".threadblock").data("threadid")})});var a={};$(".threadstatus").hover(function(){var b=$(this);a=setTimeout(function(){Forums.Common.SubmitMetricsToAI("Homepage.ThreadIconHover",{threadId:b.parents(".threadblock").data("threadid"),state:b.attr("title")})},500)},function(){clearTimeout(a)})},logSerp:function(){var c=$(document).find("#hdnPage").val(),a=$(document).find("#hdnQueryId").val(),b=$(document).find("#hdnQuery").val();if(c&&a&&b){var d={queryId:a,query:b,page:c};Forums.Common.SubmitMetricsToAI("Homepage.SearchResultPageView",d)}}};Forums.ThreadPage={wirePageElements:function(){this.attachTooltipHandler();this.getRelatedThreads();Forums.ForumDetails.wireForumDetailLinks()},wireSearchBar:function(a){$("#threadsearchbarContainer table.searchboxinnercontainer #searchimage").click(function(){var a=$(this).parents(".searchboxinnercontainer:first").find("#searchbox").not(".watermark"),b=$(a).length==1?$(a).val():"";Forums.Common.SubmitMetricsToAI("Homepage.MainSearchBoxSearchIconClicked",{searchTerm:b})});$("#threadsearchbarContainer table.searchboxinnercontainer #searchbox").watermark(a);$("#threadsearchbarContainer table.searchboxinnercontainer #searchimage").attr("aria-label",a);$("#threadsearchbarContainer table.searchboxinnercontainer #searchbox").keypress(function(b){var a=window.mscc;a&&!a.hasConsent()&&a.setConsent();if(b.which==13){Forums.Common.SubmitMetricsToAI("Homepage.EnterPressedOnSearchBox");$(this).submit()}}).click(function(){Forums.Common.SubmitMetricsToAI("Homepage.MainSearchBoxSelected")})},getRelatedThreads:function(){var a=$("#relatedThreads").data("url");a&&$.ajax({url:a}).done(function(a){$("#relatedThreads").html(a);Forums.ThreadPage.wireRelatedThreadLinks()})},attachTooltipHandler:function(){$(".forumBreadcrumb").each(function(){$(this).hover(function(){var a=$(this).children(".breadcrumbTip");if(a){a.css("top","20px");a.css("left","0px");a.show()}},function(){var a=$(this).children(".breadcrumbTip");a&&a.hide()})})},wireRelatedThreadLinks:function(){$("#relatedThreads a").click(function(b){var a={linkTitle:$(this).html(),linkHref:$(this).attr("href"),question:$('#threadPageContainer > h1 > span[name="subject"]').html(),questionId:$("#rootMessage > li.message.root").attr("id"),isQuestionAnswered:$("img.icon.question.answered").length>0};Forums.Common.SubmitMetricsToAIAndRedirect("relatedThreadsLink",a,$(this).attr("href"),b.ctrlKey);return false})},logThreadPageEnter:function(){var b=$("#rootMessage>li.message:first").attr("id"),a={threadId:b};Forums.Common.SubmitMetricsToAI("Thread.PageEnter",a)},logThreadPageDwell:function(){setTimeout(function(){var b=$("#rootMessage>li.message:first").attr("id"),a={threadId:b,dwellTimeInSecs:Forums.Constants.ThreadPageDwellTimeInSecs};Forums.Common.SubmitMetricsToAI("Thread.PageDwell",a)},Forums.Constants.ThreadPageDwellTimeInSecs*1e3)}};Forums.NewThreadPage={wire:function(){$("#forumNameLine").is(":visible")&&$("#Subject").focus()}};Forums.Toggler=function(){var a="ShowSidebar",c="#threadPageContentContainer #toggleSidebar",d="#allThreadsContainer #toggleSidebar",g="#threadPageSidebarContainer",e="#threadPageContentContainer",f="#threadPageContainer .messageContent",i="#homePageSidebarContainer",h="#homePageContentContainer",b=-1;function n(){if(!Modernizr.localstorage)localStorage={};($(c).length>0||$(d).length>0)&&l()}function m(b,e,c,d,f){if(localStorage[a]==="1"||typeof localStorage[a]==="undefined"){j(b,e,c,d,f);localStorage[a]=0}else{k(b,e,c,d,f);localStorage[a]=1}}function j(d,e,a,c,f){d.removeClass("toggleOpen").addClass("toggleClose");f==="home"&&$("#homePageFilterBarContainer").addClass("expandedFilterBar");e.css("display","none");if($(a).length==1&&b==-1)b=$(a).width();a.addClass("expandedContent");a.css("width","100%");c&&c.addClass("expandedContent")}function k(f,g,a,e,h){f.removeClass("toggleClose").addClass("toggleOpen");h==="home"&&$("#homePageFilterBarContainer").removeClass("expandedFilterBar");g.css("display","block");if($(a).length==1&&b==-1)b=$(a).width();a.removeClass("expandedContent");a.css("width",b+"px");e&&e.removeClass("expandedContent");var d=$(".profile-userimage-large"),c=$(d).children("img:first");if($(c).length===1)$(c).width()===0&&$(c).width($(d).width())}function l(){p();o()}function p(){$(d).click(function(){m($(this),$(i),$(h),null,"home")});if(typeof localStorage[a]!=="undefined")if(localStorage[a]==="0")j($(d),$(i),$(h),null,"home");else k($(d),$(i),$(h),null,"home")}function o(){$(c).click(function(){m($(this),$(g),$(e),$(f),"thread")});if(typeof localStorage[a]!=="undefined")if(localStorage[a]==="0")j($(c),$(g),$(e),$(f));else k($(c),$(g),$(e),$(f))}$(function(){n()});return{setup:n,wireToggleButton:l}}();Forums.Leaderboards={seeMore:function(a){var b=$("#rail div.leaderboards");a++;if(a>4)a=0;var c=window.leaderBoardUrl+"&leaderBoard="+a;b.fadeTo("slow",.5);b.addClass("submitting");b.parent("div").load(c)}};Forums.Users={usersAction:function(a,b){return function(){$("img.icon",a).addClass("submitting");$.post($(a).attr("href"),b,function(){$(a).remove()},"json");return false}},blockAvatar:function(){var a=$(this);$(this).click(Forums.Users.usersAction(a,{blockAvatar:true}))},unblockAvatar:function(){var a=$(this);$(this).click(Forums.Users.usersAction(a,{blockAvatar:false}))},decorateUsers:function(){$("a[name='blockUnblockAvatar']",this).each(Forums.Users.blockAvatar)}};Forums.Common={TrackCustomClick:function(d,a,b,c){typeof t_omni_utils!=="undefined"&&t_omni_utils&&t_omni_utils.omniModTracking&&t_omni_utils.omniModTracking(true,d,"",a,b,c)},FixPartnerForumContextUrls:function(e){var c=$("#p_ApplicationUrl");if(typeof c!=="undefined"&&c){var d=$("#connect-context .home-link-container a",e);typeof d!=="undefined"&&d&&d.attr("href",c.attr("value"))}var a=$("#p_ApplicationForumContextUrl");if(typeof a!=="undefined"&&a){var b=$("#connect-context .connection-link-container a",e);if(typeof b!=="undefined"&&b)if(a.attr("value"))b.attr("href",a.attr("value"));else b.remove()}},ShowPrompt:function(c,a,b){this.clicked=true;$.prompt(c,{prefix:"spWarning",top:"40%",buttons:{closeButton:{title:a,value:true}},submit:function(){window.location.replace(b)}})},SubmitMetricsToAIAndRedirect:function(d,a,c,b){if(!b){Forums.Common.SubmitMetricsToAI(d,a);setTimeout(function(){Forums.Redirect(c)},500);return false}return true},SubmitMetricsToAI:function(){},MetricsSubmittedCallback:function(){},RemoveFromArray:function(b,c){for(var a=0;a<b.length;a++)if(b[a]==c){b.splice(a,1);break}},GetBaseMetricObject:function(){var a=$("a.createProfileLink:first","div.profileName"),b="anonymous";if(a.is(":visible"))b=$(a).html();return{username:b,referrer:document.referrer,currentUrl:document.URL}}};$.addToRail=function(b,f){for(var c=$("#rail"),a=0;a<b.length;a++){var d=document.createElement("div");c.append(d);var e=b[a].indexOf("?")!=-1?"&":"?";if(b[a].indexOf("rightrailannouncement")!=-1)$(d).load(b[a]+e+"rnd="+Math.random(),null,function(){Forums.Common.FixPartnerForumContextUrls(c)});else $(d).load(b[a]+e+"rnd="+Math.random(),null,f);if(b[a].indexOf("leaderboards")!=-1)window.leaderBoardUrl=b[a]+e+"rnd="+Math.random()}c.append($(".help",c))};$.fn.popup=function(){$(this).each(function(){var b="a[name='"+$(this).attr("name")+"']",a="ul[name='"+$(this).attr("name")+"Popup']";$(this).find(Forums.Constants.ExpandCollapseImageRef).detach();$(this).append(Forums.Constants.ExpandCollapseImage);var c=function(){$("ul.popup").hide();$("body").unbind("click.popup")};$(this).click(function(d){$("ul.popup").hide();var f=$(a).width(),e=$(b).position();if($(a).attr("popupAlign")==="right")$(a).css("left",e.left+$(d.target).width()/2-f);else if($(a).attr("popupAlign")==="rightRail")$(a).css("right",$(b).offsetParent().width()-e.left);else $(a).css("left",e.left);var g=d.target.className=="expcol"?d.target.parentElement:d.target;$(a).css("top",e.top+$(g).height()*1.5);$(a).show();d.stopPropagation();$("body").bind("click.popup",c)})})};Forums.ManageRoles={selectAll:function(){if($("#selectAll").attr("checked"))$("input[name='userId']").attr("checked","checked");else $("input[name='userId']").attr("checked",false)}};$.fn.removeWatermark=function(){$(this).each(function(){if($(this).hasClass("watermark")){$(this).val("");$(this).removeClass("watermark")}})};$.removeAllWatermarks=function(){$(".watermark").each(function(){$(this).removeWatermark()})};$.fn.watermark=function(a){$(this).each(function(){$(this).removeWatermark();$(this).bind("click",function(){if($(this).hasClass("watermark")){$(this).val("");$(this).removeClass("watermark")}});$(this).bind("blur",function(){if($(this).val()==""||$(this).val()==a){$(this).addClass("watermark");$(this).val(a)}});$(this).blur()})};$.fn.watermarkVal=function(){return $(this).hasClass("watermark")?"":$(this).val()};$.fn.toggleVisibility=function(){var a="visible",b="invisible";if($(this).hasClass(a))$(this).removeClass(a).addClass(b);else $(this).removeClass(b).addClass(a)};$("input#ErrorSearchButton").on("click",function(){var b=$("input#ErrorSearchBox").val();if(!b)return;var a=$("input#SearchUri").val();if(!a)return;window.location.href=a.replace("{0}",escape(b))});Forums.Redirect=function(a){window.location.href=a};Forums.CommaSeparateAndAddListToUrl=function(a,c,b){if($(b).length>0)a+=(a.indexOf("?")>-1?"&":"?")+c+"="+encodeURIComponent(b.join(","));return a};Forums.BaseUrl=function(){return window.location.href.split("#")[0].split("?")[0]};Forums.GetJSONArray=function(a){if(a!="")try{return window.JSON?JSON.parse(a):$.parseJSON(a)}catch(b){}return[]};Forums.AppendQuestionOrAmpersandToUrl=function(a){if(a)a+=a.indexOf("?")!=-1?"&":"?";return a};Forums.ScrollWindowToTop=function(){window.scrollTo(0,0)};Forums.loadScript=function(a){$(document).ready(function(){$.ajax({async:true,type:"GET",url:a,data:null,dataType:"script",cache:true})})};jQuery.expr[":"].Contains=function(a,c,b){return jQuery(a).text().toUpperCase().indexOf(b[3].toUpperCase())>=0};